{% extends 'base.html' %}
{% load static %}

{% block title %}University Rankings{% endblock %}

{% block content %}
    <style>
        .disclaimer-section {
            background-color: #ffeeba;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.95em;
        }
        .add-university-cta {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        .ranking-explanation {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .ranking-explanation h2 {
            color: #007bff;
            margin-bottom: 10px;
        }
        .search-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .search-container input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 50%;
            max-width: 400px;
        }
        .search-container button {
            padding: 10px 15px;
            margin-left: 8px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .search-container button:hover {
            background-color: #0056b3;
        }
        .reset-button {
            background-color: #6c757d;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 8px;
        }
        .reset-button:hover {
            background-color: #5a6268;
        }
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .filter-container select, .filter-container input {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .university-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
        }
        .university-info h3 {
            margin: 0;
            color: #333;
        }
        .university-info p {
            margin: 5px 0;
            color: #777;
        }
        .scores-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .score-badge {
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            border: 1px solid #dee2e6;
        }
        .ranking-details {
            text-align: right;
            min-width: 120px;
        }
        .ranking-details h4 {
            margin: 0;
            font-size: 1.5em;
            color: #007bff;
        }
        .comparison-buttons {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }
        .cta-button {
            background-color: #007bff;
            color: white;
            padding: 8px 14px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }
        .cta-button:hover {
            background-color: #0056b3;
        }
        .return-to-home-link {
            text-align: center;
            margin-top: 25px;
        }
        @media (max-width: 768px) {
            .search-container input {
                width: 80%;
            }
            .university-card {
                flex-direction: column;
                align-items: flex-start;
            }
            .ranking-details {
                text-align: left;
            }
        }
    </style>

    <div class="disclaimer-section" role="alert">
        <p><strong>Disclaimer:</strong> The data and rankings on this page are for testing and demonstration purposes only. They do not represent the actual safety or quality of these institutions. Please do not use this data for making real-world decisions.</p>
    </div>

    <div class="add-university-cta">
        <h2>Your university is missing?</h2>
        <p>You can add it to the list and help improve the ranking for everyone.</p>
        {% if user.is_authenticated %}
            <a href="{% url 'universities:add_university' %}" class="cta-button">Add a University</a>
        {% else %}
            <a href="{% url 'accounts:register' %}" class="cta-button">Register to Add Your University</a>
        {% endif %}
    </div>

    <div class="ranking-explanation">
        <h2>Global University Rankings</h2>
        <p>Our ranking is a comprehensive and data-driven score based on user feedback. It is a composite of the following parameters:</p>
        <div class="scores-container">
            <span class="score-badge">üõ°Ô∏è Safety</span>
            <span class="score-badge">ü§ù Inclusivity</span>
            <span class="score-badge">üí¨ Student Support</span>
            <span class="score-badge">üè† Living Environment</span>
            <span class="score-badge">‚öñÔ∏è Gender Equality</span>
        </div>
    </div>

    <div class="search-container">
        <form method="GET" action="{% url 'universities:list' %}">
            <input type="text" name="q" placeholder="Search by name..." value="{{ search_query }}" aria-label="Search Universities">
            <button type="submit">Search</button>
            <button type="button" class="reset-button" onclick="resetFilters()">Reset</button>
        </form>
    </div>

    <form id="compare-form">
        {% for university in universities %}
            <div class="university-card">
                <div class="university-info">
                    <h3><a href="{% url 'universities:detail' university.slug %}">{{ university.name }}</a></h3>
                    <p>{{ university.location }}</p>
                    <p>{{ university.num_ratings }} ratings</p>
                    <div class="scores-container">
                        <span class="score-badge">Safety: {{ university.safety_score|floatformat:1 }}</span>
                        <span class="score-badge">Inclusivity: {{ university.inclusivity_score|floatformat:1 }}</span>
                        <span class="score-badge">Support: {{ university.support_score|floatformat:1 }}</span>
                        <span class="score-badge">Living: {{ university.living_score|floatformat:1 }}</span>
                        <span class="score-badge">Equality: {{ university.equality_score|floatformat:1 }}</span>
                    </div>
                </div>
                <div class="ranking-details">
                    <h4>#{{ forloop.counter }}</h4>
                    <p>Score: {{ university.ranking_score|floatformat:1 }}</p>
                    <label>
                        <input type="checkbox" name="compare_slugs" value="{{ university.slug }}"> Compare
                    </label>
                </div>
            </div>
        {% empty %}
            <p style="text-align:center; font-weight:bold;">‚ö†Ô∏è No universities found matching your criteria.</p>
        {% endfor %}
        {% if universities %}
        <div class="comparison-buttons">
            <button type="button" class="cta-button" onclick="compareSelected()">Compare Selected</button>
        </div>
        {% endif %}
    </form>

    <div class="return-to-home-link">
        <a href="{% url 'pages:home' %}" class="cta-button">Return to Homepage</a>
    </div>

    <script>
        function compareSelected() {
            const checkboxes = document.querySelectorAll('input[name="compare_slugs"]:checked');
            const slugs = Array.from(checkboxes).map(cb => cb.value);
            if (slugs.length < 2) {
                alert('Please select at least two universities to compare.');
                return;
            }
            const compareUrl = "{% url 'universities:compare' slugs='PLACEHOLDER' %}".replace('PLACEHOLDER', slugs.join('/'));
            window.location.href = compareUrl;
        }

        function resetFilters() {
            window.location.href = "{% url 'universities:list' %}";
        }
    </script>
{% endblock %}
